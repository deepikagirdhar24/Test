Feature:  Post Contact Notes API

  Scenario Outline: Verify the Post Contact Notes API
    Given Send Request to get Authentication Token for ICOS
    When I generate the JWT Token
    And Send request to generate New Person
    Then Send POST ContactNote Request
    And I verify the Status Code for Create Contact Notes "<StatusCode>"

    Examples:
      | StatusCode |
      |  200       |


@And("Send request to generate New Person")
    public void sendRequestToGenerateNewPerson() throws JsonProcessingException {
        String jwtToken = scenarioContext.getToken("JWTToken");
        response =objpostContactNotes.createNewPerson(strEnvType,"Bearer",jwtToken);
    }

public Response createNewPerson(String strEnvType,String strBearerToken,String strJWTToken) throws JsonProcessingException {
        HashMap<String,String> formParams= new HashMap<String,String>();
        String strAuthentication=strBearerToken+" "+strJWTToken;
        objCucumberLogger.PrintStatus("authenticationis"+strAuthentication);
        String strTYKURL=testDataConfig.readApplicationProperty("TYK.ENV."+strEnvType)+testDataConfig.readApplicationProperty("TYK.CREATENEWPERSON");
        objCucumberLogger.PrintStatus("URL is"+strTYKURL);

        Buffer.set("firstName", "FirstName_1");
        String firstName = Buffer.get("firstName");

        Map<String, Object> requestBody = new HashMap<>();
        requestBody.put("uuid", UUID.randomUUID().toString().substring(0,7));
        requestBody.put("subType", "pers_form_ass");
        requestBody.put("domiCountry", "CH");
        requestBody.put("firstName", firstName);
        requestBody.put("lastName", "Lastname");
        requestBody.put("gender", "male");

        Map<String, String> item = new HashMap<>();
        item.put("item", "CH");

        List<Map<String, String>> nationalities = new ArrayList<>();
        nationalities.add(item);

        requestBody.put("nationalities", nationalities);

        String jsonBody = new ObjectMapper().writeValueAsString(requestBody);

        response = with().spec(rspec)
                .header("Authorization",strBearerToken+" "+strJWTToken)
                .header("X-TYK-API-KEY",TYK_KEY)
                .body(jsonBody)
                .post(strTYKURL);
        responseBody = objdevHelperLibrary.getResponseBody(response);
        objCucumberLogger.PrintStatus("Status code is"+response.statusCode());
        objCucumberLogger.PrintStatus("Response is"+responseBody);
        return response;
    }

[INFO] 
[INFO] --- maven-surefire-plugin:3.0.0-M5:test (default-test) @ wealth-icos-api ---
[INFO] 
[INFO] -------------------------------------------------------
[INFO]  T E S T S
[INFO] -------------------------------------------------------
[INFO] Running testRunner.Runner
Scenario Outline: Verify the Post Contact Notes API           # src/test/resources/Features/CreateContactNotes.feature:12
Before All
May 07, 2025 8:21:45 AM hooks.CucumberHooks beforeScenario
INFO: Before Scenario: Test is starting!
May 07, 2025 8:21:50 AM utilities.CucumberLogger PrintStatus
INFO: Value is: Access Token is51kgmaz2Nn5NtJPlkU4wolFcwyDp
May 07, 2025 8:21:50 AM utilities.CucumberLogger PrintStatus
INFO: Value is: Access Token  is{accessToken=51kgmaz2Nn5NtJPlkU4wolFcwyDp, tokenType=Bearer}
  Given Send Request to get Authentication Token for ICOS     # stepDefinations.GetUserSteps.sendRequestToGetAuthenticationTokenForICOS()
May 07, 2025 8:21:51 AM utilities.CucumberLogger PrintStatus
INFO: Value is: Tyk Token iseyJhbGciOiJSUzI1NiJ9.eyJpc3MiOiJzdXAtYW1pd3Mtand0LWdlbmVyYXRvciIsInN1YiI6IlJCU0MkQ0xNX09OQk9BUkRJTkciLCJhdWQiOiJBTUlXZWJTZXJ2aWNlcyIsImV4cCI6MTc0NjYwMzQxMSwiaWF0IjoxNzQ2NjAyNTExLCJhdmFsb3FfYnVfaWQiOiI2In0.iVS2GnpyDvmHYuJOftSKGplog5qp2Ed1YoWE7GrD3JWp7ekV6NxmqgTm46mezA8jVsG8CllQ6atiIqI7pB3AhHPkR4YaQTiUD7NujfiK4eUkc8DDWfhPM61buTqx5svXeK706Jne0N2bU3ltMx1rVc1kZm8oxXGEIx_Cqt5d1eLwDR85ZJTdwXE7JUSB_fESwQ4fLtUyR8RtdIbE_Pnve-Oz0flySAso_tQAmGwtK5BNuscVnmBifdJSH9L8syPMx2ISpZSOGJ-bHMdvHxOoaT640gWr5DWqjnnIp9L7tocSlyAUXrgYiE8kagZgyp0bCdBAvvKVxJNDVc1b_GVYBQ
  When I generate the JWT Token                               # stepDefinations.GetUserSteps.iGenerateTheJWTToken()
May 07, 2025 8:21:51 AM utilities.CucumberLogger PrintStatus
INFO: Value is: authenticationisBearer eyJhbGciOiJSUzI1NiJ9.eyJpc3MiOiJzdXAtYW1pd3Mtand0LWdlbmVyYXRvciIsInN1YiI6IlJCU0MkQ0xNX09OQk9BUkRJTkciLCJhdWQiOiJBTUlXZWJTZXJ2aWNlcyIsImV4cCI6MTc0NjYwMzQxMSwiaWF0IjoxNzQ2NjAyNTExLCJhdmFsb3FfYnVfaWQiOiI2In0.iVS2GnpyDvmHYuJOftSKGplog5qp2Ed1YoWE7GrD3JWp7ekV6NxmqgTm46mezA8jVsG8CllQ6atiIqI7pB3AhHPkR4YaQTiUD7NujfiK4eUkc8DDWfhPM61buTqx5svXeK706Jne0N2bU3ltMx1rVc1kZm8oxXGEIx_Cqt5d1eLwDR85ZJTdwXE7JUSB_fESwQ4fLtUyR8RtdIbE_Pnve-Oz0flySAso_tQAmGwtK5BNuscVnmBifdJSH9L8syPMx2ISpZSOGJ-bHMdvHxOoaT640gWr5DWqjnnIp9L7tocSlyAUXrgYiE8kagZgyp0bCdBAvvKVxJNDVc1b_GVYBQ
May 07, 2025 8:21:51 AM utilities.CucumberLogger PrintStatus
INFO: Value is: URL ishttps://tyk-gateway.tadpole.uat01-fds.wealth.banksvcs.net/avq/acpr/sas-person/v1/natural-persons
May 07, 2025 8:21:52 AM utilities.CucumberLogger PrintStatus
INFO: Value is: Status code is400
May 07, 2025 8:21:52 AM utilities.CucumberLogger PrintStatus
INFO: Value is: Response is{"status":400,"type":"/aws/client_error","detail":"The service cannot and will not process the request because there is a client error in the request","title":"Client Error","errorDetails":[]}
  And Send request to generate New Person                     # stepDefinations.CreateContactSteps.sendRequestToGenerateNewPerson()
  Then Send POST ContactNote Request                          # stepDefinations.CreateContactSteps.sendPOSTContactNoteRequest()
  And I verify the Status Code for Create Contact Notes "200" # stepDefinations.CreateContactSteps.iVerifyTheStatusCodeForCreateContactNotes(java.lang.String)
      java.lang.AssertionError: expected [400] but found [200]
	at org.testng.Assert.fail(Assert.java:111)
	at org.testng.Assert.failNotEquals(Assert.java:1578)
	at org.testng.Assert.assertEqualsImpl(Assert.java:150)
	at org.testng.Assert.assertEquals(Assert.java:132)
	at org.testng.Assert.assertEquals(Assert.java:1419)
	at org.testng.Assert.assertEquals(Assert.java:1383)
	at org.testng.Assert.assertEquals(Assert.java:1429)
	at stepDefinations.CreateContactSteps.iVerifyTheStatusCodeForCreateContactNotes(CreateContactSteps.java:99)
	at âœ½.I verify the Status Code for Create Contact Notes "200"(file:///C:/Users/girdd/IdeaProjects/icosapitests/src/test/resources/Features/CreateContactNotes.feature:8)
May 07, 2025 8:21:54 AM tech.grasshopper.pdf.PDFCucumberReport collectReportConfiguration
INFO: PDF report configuration YAML file not found. Using default settings.
[ERROR] Tests run: 1, Failures: 1, Errors: 0, Skipped: 0, Time elapsed: 12.906 s <<< FAILURE! - in testRunner.Runner
[ERROR] Post Contact Notes API.Verify the Post Contact Notes API  Time elapsed: 7.574 s  <<< FAILURE!
java.lang.AssertionError: expected [400] but found [200]
[INFO] 
[INFO] Results:
[INFO] 
[ERROR] Failures: 
[ERROR]   expected [400] but found [200]
[INFO] 
[ERROR] Tests run: 1, Failures: 1, Errors: 0, Skipped: 0
[INFO] 

