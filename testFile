public static POJONewDocumentRequest buildNewDocumentPayload(Map<String, String> mapDocDetails, ScenarioContext scenarioContext) {
    POJONewDocumentRequest documentRequest = new POJONewDocumentRequest();

    String strNaturalPersonObjectId = scenarioContext.getContext("naturalPersonObjectId");

    // Use overridden personId from map (for negative test), else default from context
    if (mapDocDetails.containsKey("personId") && mapDocDetails.get("personId") != null && !mapDocDetails.get("personId").isEmpty()) {
        documentRequest.setStrPersonId(mapDocDetails.get("personId"));
    } else {
        documentRequest.setStrPersonId(strNaturalPersonObjectId);
    }

    documentRequest.setStrChallengeWord(mapDocDetails.get("challengeWord"));

    List<POJONewDocumentRequest.QuestionAnswer> qaList = new ArrayList<>();

    for (int i = 1; i <= 5; i++) {
        String questionKey = "question" + i;
        String answerKey = "answer" + i;

        if (mapDocDetails.containsKey(questionKey) && mapDocDetails.containsKey(answerKey)) {
            POJONewDocumentRequest.QuestionAnswer qa = new POJONewDocumentRequest.QuestionAnswer();
            qa.setStrQuestion(mapDocDetails.get(questionKey));
            qa.setStrAnswer(mapDocDetails.get(answerKey));
            qaList.add(qa);
        }
    }

    documentRequest.setLstQuestions(qaList);
    return documentRequest;
}

public Response createNewDocument(String strEnvType, String strBearerToken, String strJwtToken, Map<String, String> mapDocDetails, ScenarioContext scenarioContext) throws JsonProcessingException {
    String strUrl = getTYKURL(strEnvType, "TYK.DOCUMENT");

    POJONewDocumentRequest pojoNewDocumentRequest = Payloads.buildNewDocumentPayload(mapDocDetails, scenarioContext);
    String strRequestBody = objObjectMapper.writeValueAsString(pojoNewDocumentRequest);

    ExtentCucumberAdapter.addTestStepLog("Sending request to create Document");

    Response resCreateDocument = sendPostRequest(strUrl, strBearerToken, strJwtToken, strRequestBody, null);
    String strResponseBody = devHelperLibrary.getResponseBody(resCreateDocument);
    objCucumberLogger.PrintStatus("Response is: " + strResponseBody);

    // Optional: Store document ID from response
    String strDocumentId = resCreateDocument.jsonPath().getString("documentId");
    scenarioContext.setContext("documentId", strDocumentId);

    return resCreateDocument;
}
