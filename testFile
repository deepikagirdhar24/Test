@And("I verify the error response for Work Request with below details")
public void iVerifyTheErrorResponseforWorkRequestWithDetails(DataTable dataTable) throws Exception {
    Map<String, String> mapResponseData = dataTable.asMap(String.class, String.class);

    boolean isCheckPerformed = false;

    if (mapResponseData.containsKey("description") && mapResponseData.containsKey("error message")
            && mapResponseData.get("description") != null && !mapResponseData.get("description").isEmpty()) {

        String expectedDescription = mapResponseData.get("description");
        String actualDescription = JsonHelper.extractStringField(response, "description");
        ExtentCucumberAdapter.addTestStepLog("Actual description: " + actualDescription);
        Assert.assertEquals(actualDescription, expectedDescription, "Mismatch in description");

        String[] expectedErrors = mapResponseData.get("error message").split("\\s*,\\s*");
        List<String> actualErrors = JsonHelper.extractListOfStringFieldsFromArray(response, "validationErrors", "error");
        ExtentCucumberAdapter.addTestStepLog("Actual error messages: " + actualErrors);

        for (String expectedError : expectedErrors) {
            Assert.assertTrue(actualErrors.contains(expectedError), "Expected error not found: " + expectedError);
        }

        isCheckPerformed = true;

    } else if (mapResponseData.containsKey("error message")
            && mapResponseData.get("error message") != null && !mapResponseData.get("error message").isEmpty()) {

        String expectedError = mapResponseData.get("error message");
        String actualError = JsonHelper.extractStringField(response, "error");
        ExtentCucumberAdapter.addTestStepLog("Actual error: " + actualError);
        Assert.assertEquals(actualError, expectedError, "Mismatch in error message");

        isCheckPerformed = true;

    } else if (mapResponseData.containsKey("detail")
            && mapResponseData.get("detail") != null && !mapResponseData.get("detail").isEmpty()) {

        String expectedDetail = mapResponseData.get("detail");
        String actualDetail = JsonHelper.extractStringField(response, "detail");
        ExtentCucumberAdapter.addTestStepLog("Actual detail: " + actualDetail);
        Assert.assertEquals(actualDetail, expectedDetail, "Mismatch in detail field");

        isCheckPerformed = true;
    }

    // If none of the above checks were performed, just log and move on
    if (!isCheckPerformed) {
        ExtentCucumberAdapter.addTestStepLog("No expected error fields were defined in the DataTable. Skipping error verification.");
    }
}
