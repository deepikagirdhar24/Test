package ICOS;

import ICOS.pojo.ContactNoteRequest;
import com.fasterxml.jackson.core.JsonProcessingException;
import com.fasterxml.jackson.databind.ObjectMapper;
import io.restassured.response.Response;
import utilities.CucumberLogger;
import utilities.Payloads;
import utilities.ScenarioContext;
import com.aventstack.extentreports.cucumber.adapter.ExtentCucumberAdapter;

import java.util.HashMap;
import java.util.List;
import java.util.Map;

public class ContactNotes extends BaseApiClient {

    private ObjectMapper objectMapper;
    private CucumberLogger cucumberLogger;

    public ContactNotes() {
        objectMapper = new ObjectMapper();
        cucumberLogger = new CucumberLogger();
    }

    // Create Contact Note for single PersonId
    public Response createContactNote(String strEnvType, String strBearerToken, String strJWTToken,
                                      Map<String, String> mapNoteDetails, ScenarioContext scenarioContext) throws JsonProcessingException {

        String strTYKURL = getTYKURL(strEnvType, "TYK.CONTACTNOTES");
        ContactNoteRequest noteRequest = Payloads.buildContactNotePayload(mapNoteDetails, scenarioContext);
        String requestBody = objectMapper.writeValueAsString(noteRequest);

        ExtentCucumberAdapter.addTestStepLog("Sending request to Create Contact Note");

        Response response = sendPostRequest(strTYKURL, strBearerToken, strJWTToken, requestBody, null);
        String responseBody = devHelperLibrary.getResponseBody(response);
        cucumberLogger.PrintStatus("Response is: " + responseBody);

        return response;
    }

    // Create Contact Note for multiple PersonIds
    public Response createContactNote(String strEnvType, String strBearerToken, String strJWTToken,
                                      Map<String, String> mapNoteDetails, List<String> lstPersonIds) throws JsonProcessingException {

        String strTYKURL = getTYKURL(strEnvType, "TYK.CONTACTNOTES");
        ContactNoteRequest noteRequest = Payloads.buildContactNotePayload(mapNoteDetails, lstPersonIds);
        String requestBody = objectMapper.writeValueAsString(noteRequest);

        ExtentCucumberAdapter.addTestStepLog("Sending request to Create Contact Note for multiple PersonIds");

        Response response = sendPostRequest(strTYKURL, strBearerToken, strJWTToken, requestBody, null);
        String responseBody = devHelperLibrary.getResponseBody(response);
        cucumberLogger.PrintStatus("Response is: " + responseBody);

        return response;
    }

    // Get Contact Notes
    public Response getContactNotes(String strEnvType, String strBearerToken, String strJWTToken) {

        String strTYKURL = getTYKURL(strEnvType, "TYK.CONTACTNOTES");

        ExtentCucumberAdapter.addTestStepLog("Sending GET request to fetch Contact Notes");

        Response response = sendGetRequest(strTYKURL, strBearerToken, strJWTToken, null, null);
        String responseBody = devHelperLibrary.getResponseBody(response);
        cucumberLogger.PrintStatus("Response is: " + responseBody);

        return response;
    }
}
