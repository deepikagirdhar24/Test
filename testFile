Feature:  Post Contact Notes API

  Scenario Outline: Verify the Post Contact Notes API
    Given Send Request to get Authentication Token for ICOS
    When I generate the JWT Token
    And Send request to generate New Person
    Then Send POST ContactNote Request
    And I verify the Status Code for Create Contact Notes "<StatusCode>"

    Examples:
      | StatusCode |
      |  200       |


@And("Send request to generate New Person")
    public void sendRequestToGenerateNewPerson() throws JsonProcessingException {
        String jwtToken = scenarioContext.getToken("JWTToken");
        response =objpostContactNotes.createNewPerson(strEnvType,"Bearer",jwtToken);
    }

public Response createNewPerson(String strEnvType,String strBearerToken,String strJWTToken) throws JsonProcessingException {
        HashMap<String,String> formParams= new HashMap<String,String>();
        String strAuthentication=strBearerToken+" "+strJWTToken;
        objCucumberLogger.PrintStatus("authenticationis"+strAuthentication);
        String strTYKURL=testDataConfig.readApplicationProperty("TYK.ENV."+strEnvType)+testDataConfig.readApplicationProperty("TYK.CREATENEWPERSON");
        objCucumberLogger.PrintStatus("URL is"+strTYKURL);

        Buffer.set("firstName", "FirstName_1");
        String firstName = Buffer.get("firstName");

        Map<String, Object> requestBody = new HashMap<>();
        requestBody.put("uuid", UUID.randomUUID().toString().substring(0,7));
        objCucumberLogger.PrintStatus(requestBody.get("uuid").toString());
        requestBody.put("subType", "pers_form_ass");
        objCucumberLogger.PrintStatus(requestBody.get("subType").toString());
        requestBody.put("domiCountry", "CH");
        objCucumberLogger.PrintStatus(requestBody.get("domiCountry").toString());
        requestBody.put("firstName", firstName);
        objCucumberLogger.PrintStatus(requestBody.get("firstName").toString());
        requestBody.put("lastName", "Lastname");
        objCucumberLogger.PrintStatus(requestBody.get("lastName").toString());
        requestBody.put("gender", "male");
        objCucumberLogger.PrintStatus(requestBody.get("gender").toString());

        List<String> nationalities = new ArrayList<>();
        nationalities.add("CH");

        requestBody.put("nationalities", nationalities);
        objCucumberLogger.PrintStatus(requestBody.get("nationalities").toString());

        String jsonBody = new ObjectMapper().writeValueAsString(requestBody);
        objCucumberLogger.PrintStatus(jsonBody);

        response = with().spec(rspec)
                .header("Authorization",strBearerToken+" "+strJWTToken)
                .header("X-TYK-API-KEY",TYK_KEY)
                .body(jsonBody)
                .post(strTYKURL);
        responseBody = objdevHelperLibrary.getResponseBody(response);
        objCucumberLogger.PrintStatus("Status code is"+response.statusCode());
        objCucumberLogger.PrintStatus("Response is"+responseBody);
        return response;
    }

Payload is - 

{
    "uuid": "12345",
    "subType": "pers_form_ass",
    "domiCountry": "GB",
    "firstName": "Firstname",
    "lastName": "Lastname",
    "gender": "male",
    "nationalities": [
        "GB"
    ]
} 

Error is - [INFO] 
[INFO] --- maven-surefire-plugin:3.0.0-M5:test (default-test) @ wealth-icos-api ---
[INFO] 
[INFO] -------------------------------------------------------
[INFO]  T E S T S
[INFO] -------------------------------------------------------
[INFO] Running testRunner.Runner
Scenario Outline: Verify the Post Contact Notes API           # src/test/resources/Features/CreateContactNotes.feature:12
Before All
May 07, 2025 9:14:39 AM hooks.CucumberHooks beforeScenario
INFO: Before Scenario: Test is starting!
May 07, 2025 9:14:43 AM utilities.CucumberLogger PrintStatus
INFO: Value is: Access Token is51kg3OyFUsQLxGOpD42WvOqr85j5
May 07, 2025 9:14:43 AM utilities.CucumberLogger PrintStatus
INFO: Value is: Access Token  is{accessToken=51kg3OyFUsQLxGOpD42WvOqr85j5, tokenType=Bearer}
  Given Send Request to get Authentication Token for ICOS     # stepDefinations.GetUserSteps.sendRequestToGetAuthenticationTokenForICOS()
May 07, 2025 9:14:44 AM utilities.CucumberLogger PrintStatus
INFO: Value is: Tyk Token iseyJhbGciOiJSUzI1NiJ9.eyJpc3MiOiJzdXAtYW1pd3Mtand0LWdlbmVyYXRvciIsInN1YiI6IlJCU0MkQ0xNX09OQk9BUkRJTkciLCJhdWQiOiJBTUlXZWJTZXJ2aWNlcyIsImV4cCI6MTc0NjYwNjU4NSwiaWF0IjoxNzQ2NjA1Njg1LCJhdmFsb3FfYnVfaWQiOiI2In0.DwjkZoVWJQKF2Vj2s8KMrTjSub2N-PghzB3OYVVKL1ue2MM6Yw4WiuRMOXxbQq8un8fghFRWenizRnDf8bIBGuXmPK0Lf30y99foeJ-TF1lAnSPBCJKhJRRiczk3cf6_tlH2clTYhcuENG1N9LJ1Dbm3xd0_-pH9-tdy7DhvWCt23cHoFYBEBGsVesBHpa-ZNMmQRauHwhnjWIfWaOjcSUxsLTbW_p6yBccBkC10yp86n6RcVeffftp_oWcg7lIkx-5oOA6E6qy4qEP63L265orJ0Wmzd1X-D7n-wuve1bDASumhF_6THW9osZkkEhVYY19ZuCN2PIhKy1UgmLhuAw
  When I generate the JWT Token                               # stepDefinations.GetUserSteps.iGenerateTheJWTToken()
May 07, 2025 9:14:44 AM utilities.CucumberLogger PrintStatus
INFO: Value is: authenticationisBearer eyJhbGciOiJSUzI1NiJ9.eyJpc3MiOiJzdXAtYW1pd3Mtand0LWdlbmVyYXRvciIsInN1YiI6IlJCU0MkQ0xNX09OQk9BUkRJTkciLCJhdWQiOiJBTUlXZWJTZXJ2aWNlcyIsImV4cCI6MTc0NjYwNjU4NSwiaWF0IjoxNzQ2NjA1Njg1LCJhdmFsb3FfYnVfaWQiOiI2In0.DwjkZoVWJQKF2Vj2s8KMrTjSub2N-PghzB3OYVVKL1ue2MM6Yw4WiuRMOXxbQq8un8fghFRWenizRnDf8bIBGuXmPK0Lf30y99foeJ-TF1lAnSPBCJKhJRRiczk3cf6_tlH2clTYhcuENG1N9LJ1Dbm3xd0_-pH9-tdy7DhvWCt23cHoFYBEBGsVesBHpa-ZNMmQRauHwhnjWIfWaOjcSUxsLTbW_p6yBccBkC10yp86n6RcVeffftp_oWcg7lIkx-5oOA6E6qy4qEP63L265orJ0Wmzd1X-D7n-wuve1bDASumhF_6THW9osZkkEhVYY19ZuCN2PIhKy1UgmLhuAw
May 07, 2025 9:14:44 AM utilities.CucumberLogger PrintStatus
INFO: Value is: URL ishttps://tyk-gateway.tadpole.uat01-fds.wealth.banksvcs.net/avq/acpr/sas-person/v1/natural-persons
May 07, 2025 9:14:44 AM utilities.CucumberLogger PrintStatus
INFO: Value is: 230e78e
May 07, 2025 9:14:44 AM utilities.CucumberLogger PrintStatus
INFO: Value is: pers_form_ass
May 07, 2025 9:14:44 AM utilities.CucumberLogger PrintStatus
INFO: Value is: CH
May 07, 2025 9:14:44 AM utilities.CucumberLogger PrintStatus
INFO: Value is: FirstName_1
May 07, 2025 9:14:44 AM utilities.CucumberLogger PrintStatus
INFO: Value is: Lastname
May 07, 2025 9:14:44 AM utilities.CucumberLogger PrintStatus
INFO: Value is: male
May 07, 2025 9:14:44 AM utilities.CucumberLogger PrintStatus
INFO: Value is: [CH]
May 07, 2025 9:14:44 AM utilities.CucumberLogger PrintStatus
INFO: Value is: {"firstName":"FirstName_1","lastName":"Lastname","domiCountry":"CH","gender":"male","subType":"pers_form_ass","nationalities":["CH"],"uuid":"230e78e"}
May 07, 2025 9:14:45 AM utilities.CucumberLogger PrintStatus
INFO: Value is: Status code is400
May 07, 2025 9:14:45 AM utilities.CucumberLogger PrintStatus
INFO: Value is: Response is{"status":400,"type":"/aws/client_error","detail":"The service cannot and will not process the request because there is a client error in the request","title":"Client Error","errorDetails":[]}
  And Send request to generate New Person                     # stepDefinations.CreateContactSteps.sendRequestToGenerateNewPerson()
  Then Send POST ContactNote Request                          # stepDefinations.CreateContactSteps.sendPOSTContactNoteRequest()
  And I verify the Status Code for Create Contact Notes "200" # stepDefinations.CreateContactSteps.iVerifyTheStatusCodeForCreateContactNotes(java.lang.String)
      java.lang.AssertionError: expected [400] but found [200]
	at org.testng.Assert.fail(Assert.java:111)
	at org.testng.Assert.failNotEquals(Assert.java:1578)
	at org.testng.Assert.assertEqualsImpl(Assert.java:150)
	at org.testng.Assert.assertEquals(Assert.java:132)
	at org.testng.Assert.assertEquals(Assert.java:1419)
	at org.testng.Assert.assertEquals(Assert.java:1383)
	at org.testng.Assert.assertEquals(Assert.java:1429)
	at stepDefinations.CreateContactSteps.iVerifyTheStatusCodeForCreateContactNotes(CreateContactSteps.java:99)
	at âœ½.I verify the Status Code for Create Contact Notes "200"(file:///C:/Users/girdd/IdeaProjects/icosapitests/src/test/resources/Features/CreateContactNotes.feature:8)
May 07, 2025 9:14:47 AM tech.grasshopper.pdf.PDFCucumberReport collectReportConfiguration
INFO: PDF report configuration YAML file not found. Using default settings.
[ERROR] Tests run: 1, Failures: 1, Errors: 0, Skipped: 0, Time elapsed: 11.703 s <<< FAILURE! - in testRunner.Runner
[ERROR] Post Contact Notes API.Verify the Post Contact Notes API  Time elapsed: 7.492 s  <<< FAILURE!
java.lang.AssertionError: expected [400] but found [200]
[INFO] 
[INFO] Results:
[INFO] 
[ERROR] Failures: 
[ERROR]   expected [400] but found [200]
[INFO] 
[ERROR] Tests run: 1, Failures: 1, Errors: 0, Skipped: 0
[INFO] 
