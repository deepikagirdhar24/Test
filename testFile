package ICOS;

import com.aventstack.extentreports.cucumber.adapter.ExtentCucumberAdapter;
import com.fasterxml.jackson.databind.ObjectMapper;
import io.restassured.response.Response;
import utilities.CucumberLogger;
import utilities.EncryptionUtil;
import utilities.ScenarioContext;
import commonLibrary.devHelperLibrary;

import java.util.HashMap;
import java.util.Map;

public class GetUser extends BaseApiClient {

    private ObjectMapper objObjectMapper;
    private CucumberLogger objCucumberLogger;
    private EncryptionUtil objEncryptionUtil;

    public GetUser() throws Exception {
        objObjectMapper = new ObjectMapper();
        objCucumberLogger = new CucumberLogger();
        objEncryptionUtil = new EncryptionUtil();
    }

    // Get User by ID
    public Response getUserById(String strEnvType, String strBearerToken, String strJwtToken, String strUserId, ScenarioContext scenarioContext) {
        String strUrl = getTYKURL(strEnvType, "TYK.USERID") + "/{userId}";

        Map<String, String> mapPathParams = new HashMap<>();
        mapPathParams.put("userId", strUserId);

        ExtentCucumberAdapter.addTestStepLog("Sending GET request to fetch user by ID");

        Response resGetUser = sendGetRequest(strUrl, strBearerToken, strJwtToken, mapPathParams, null);
        String strResponseBody = devHelperLibrary.getResponseBody(resGetUser);
        objCucumberLogger.PrintStatus("Response is: " + strResponseBody);

        scenarioContext.setContext("fetchedUserId", strUserId);

        return resGetUser;
    }
}
