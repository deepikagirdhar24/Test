public static POJOContactNoteRequest buildContactNotePayload(Map<String, String> mapNoteDetails, ScenarioContext scenarioContext) {

    POJOContactNoteRequest noteRequest = new POJOContactNoteRequest();
    String strNaturalPersonObjectId = scenarioContext.getContext("naturalPersonObjectId");

    // Set PersonIds: Use derived objectId if keyword passed or missing, else use provided value
    String personId = mapNoteDetails.get("personIds");

    if (personId == null || personId.trim().isEmpty() || personId.equalsIgnoreCase("EMPTY")) {
        noteRequest.setLstPersonIds(Collections.singletonList(""));
    } else if (personId.equalsIgnoreCase("NATURAL_PERSON_OBJECT_ID")) {
        noteRequest.setLstPersonIds(Collections.singletonList(strNaturalPersonObjectId));
    } else {
        noteRequest.setLstPersonIds(Collections.singletonList(personId));
    }

    // Set subject using dynamic resolver
    noteRequest.setStrSubject(
        mapNoteDetails.get("subject") != null
            ? TestDataGenerator.resolveDynamicText(mapNoteDetails.get("subject"))
            : ""
    );

    noteRequest.setStrNotes(
        mapNoteDetails.get("notes") != null ? mapNoteDetails.get("notes") : ""
    );

    noteRequest.setBoolHasFollowup(Boolean.parseBoolean(mapNoteDetails.get("hasFollowup")));

    return noteRequest;
}

Scenario Outline: Verify the Post Contact Notes API with invalid or dynamic data - <Comments>
  Given Send Request to get Authentication Token for ICOS
  When I generate the JWT Token
  And Send request to generate New Person with below details
    | firstName       | Firstname     |
    | lastName        | Lastname      |
    | subType         | pers_form_ass |
    | domicileCountry | CH            |
    | gender          | male          |
    | nationalities   | CH            |
  Then Send POST ContactNote Request with below details
    | personIds    | <personIds>   |
    | subject      | <subject>     |
    | notes        | <notes>       |
    | hasFollowup  | <hasFollowup> |
  And I verify the Status Code for Contact Notes "<statusCode>"
  And I verify the Contact Notes API 400 error response with below details
    | description   | <description> |
    | error message | <error>       |

Examples:
  | personIds               | subject        | notes    | hasFollowup | statusCode | description        | error                       | Comments                      |
  | ghgf                   | TestSubject    | Testnote | false       | 400        | Validation Errors  | Person not found            | Invalid person ID             |
  | NATURAL_PERSON_OBJECT_ID | RANDOM_GT_250 | Testnote | false       | 400        | Validation Errors  | subject too long (max 250)  | Long subject with valid ID    |
