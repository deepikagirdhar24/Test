@Research
  Scenario Outline: Verify the Get User API for User with Greater Than 0 Teams
    Given Send Request to get Authentication Token for ICOS
    When I generate the JWT Token
    And I get the Customer ID from Database "<SQLQueries>"
    Then Send Request to get User Role Information
    And I verify the Status Code "<StatusCode>"
    And I verify the BU Name "<BU>"
#    And I verify the TeamID "<TeamID>"
    And I verify the TeamId exists


    Examples:
      | SQLQueries                     | BU      | TeamID          | StatusCode |
      | UserwithGreaterThan0TeamsQuery | RBS.CUK | £H6_0_00_00_037 |200         |

  @Research
  Scenario Outline: Verify the Get User API for User with One BU
    Given Send Request to get Authentication Token for ICOS
    When I generate the JWT Token
    And I get the Customer ID from Database "<SQLQueries>"
    Then Send Request to get User Role Information
    And I verify the Status Code "<StatusCode>"
    And I verify the BU Name "<BU>"
    And I verify the UserId

    Examples:
      | SQLQueries       | BU      | StatusCode |
      | UserWith1BUQuery | RBS.CUK |200         |

    @And("I verify the BU Name {string}")
    public void iVerifyTheBUName(String strBU) throws JsonProcessingException{
        boolean boolHasBURole= objgetUser.hasBURole(response,strBU);
        Assert.assertEquals(true,boolHasBURole);
    }

public boolean hasBURole(Response response, String buName) throws JsonProcessingException {
        JsonNode rootNode = objectMapper.readTree(response.asString());
        JsonNode businessUnitsNode = rootNode.path("businessUnits");
        if (businessUnitsNode.isArray()) {
            for (JsonNode buNode : businessUnitsNode) {
                String currentBU = buNode.path("bu").asText();
                if (buName.equals(currentBU)) {
                    return true;
                }
            }
        }
        return false;
    }

    @And("I verify the TeamId exists")
    public void iVerifyTheTeamIdExists() throws Exception {
        jsonHelper.validateFieldExistsInArray(response, "/privateBanker/teams", "id");
    }

public void validateFieldExistsInArray(Response response, String arrayPath, String fieldName) throws Exception {
        JsonNode rootNode = objectMapper.readTree(response.asString());
        JsonNode arrayNode = rootNode.at(arrayPath); // Path should start with '/' for root level

        if (!arrayNode.isArray()) {
            throw new Exception("Expected an array at path: " + arrayPath);
        }

        for (JsonNode element : arrayNode) {
            JsonNode fieldNode = element.get(fieldName);
            if (fieldNode == null || fieldNode.asText().isEmpty()) {
                throw new AssertionError("Missing or empty '" + fieldName + "' in one of the elements at: " + arrayPath);
            }
        }

        ExtentCucumberAdapter.addTestStepLog("All elements in array " + arrayPath + " contain a valid '" + fieldName + "'");
    }

    @And("I verify the UserId")
    public void iVerifyTheUserId() throws Exception {
        String strActualUserId=jsonHelper.extractStringField(response, "id");
        ExtentCucumberAdapter.addTestStepLog("Actual value of UserId is : " +strActualUserId);
        Assert.assertEquals(strUserid,strActualUserId);
    }

    public String extractStringField(Response response, String fieldPath) throws Exception {
        JsonNode rootNode = objectMapper.readTree(response.asString());
        JsonNode node = getNodeByPath(rootNode, fieldPath);
        return node.isMissingNode() || node.isNull() ? null : node.asText();
    }

[INFO] 
[INFO] --- maven-surefire-plugin:3.0.0-M5:test (default-test) @ wealth-icos-api ---
[INFO] 
[INFO] -------------------------------------------------------
[INFO]  T E S T S
[INFO] -------------------------------------------------------
[INFO] Running testRunner.Runner
@Research
Scenario Outline: Verify the Get User API for User with Greater Than 0 Teams # src/test/resources/Features/GetUser.feature:58
Before All
Sept 24, 2025 10:37:06 AM hooks.CucumberHooks beforeScenario
INFO: Before Scenario: Test is starting!
  Given Send Request to get Authentication Token for ICOS                    # stepDefinations.GetUserSteps.sendRequestToGetAuthenticationTokenForICOS()
  When I generate the JWT Token                                              # stepDefinations.GetUserSteps.iGenerateTheJWTToken()
  And I get the Customer ID from Database "UserwithGreaterThan0TeamsQuery"   # stepDefinations.GetUserSteps.iGetTheCustomerIDFromDatabase(java.lang.String)
Sept 24, 2025 10:37:15 AM utilities.CucumberLogger PrintStatus
INFO: Value is: Response is: {"id":"GOULDM","name":"Marrianne Gould","privateBanker":{"id":"GOULDM","name":"Marrianne Gould","teams":[{"id":"£H6_0_00_00_004","name":"PB UK Bristol*004"},{"id":"£H6_0_00_00_031","name":"PB UK Hampshire*031"},{"id":"£H6_0_00_00_011","name":"PB UK Cardiff*011"}]},"businessUnits":[{"bu":"PUBL","roles":[{"name":"R_AM_BANK_TEST"},{"name":"R_TECHNICAL_ACCOUNTING"},{"name":"R_TECHNICAL_COLLECT"},{"name":"R_TECHNICAL_CREDIT"},{"name":"R_TECHNICAL_CS_VIEW"},{"name":"R_TECHNICAL_CTACT"}  Then Send Request to get User Role Information                             # stepDefinations.GetUserSteps.sendRequestToGetUserRoleInformation()
  And I verify the Status Code "200"                                         # stepDefinations.GetUserSteps.iVerifyTheStatusCode(java.lang.String)
  And I verify the BU Name "RBS.CUK"                                         # stepDefinations.GetUserSteps.iVerifyTheBUName(java.lang.String)
  And I verify the TeamId exists                                             # stepDefinations.GetUserSteps.iVerifyTheTeamIdExists()
      java.lang.NullPointerException: Cannot invoke "utilities.JsonHelper.validateFieldExistsInArray(io.restassured.response.Response, String, String)" because "this.jsonHelper" is null
	at stepDefinations.GetUserSteps.iVerifyTheTeamIdExists(GetUserSteps.java:189)
	at âœ½.I verify the TeamId exists(file:///C:/Users/girdd/IdeaProjects/icosapitests/src/test/resources/Features/GetUser.feature:53)
£SENTI_BUSINESS_UNIT"},{"name":"R_TECHNICAL_RO_ADAM"},{"name":"R_TECHNICAL_EARCH_ADAM"},{"name":"R_TECHNICAL_ELAS_ALL"},{"name":"£PRT_USERBOX"},{"name":"R_TECHNICAL_RO_ADAMI"},{"name":"R_TECHNICAL_ELAS_ALL"},{"name":"R_TECHNICAL_RO_COUTTS"},{"name":"R_TECHNIA"},{"name":"R_TECHNICAL_RO_PBA"},{"name"O_TPFM"},{"name":"R_TECHNICAL_SERPIL"}
@Research
Scenario Outline: Verify the Get User API for User with One BU # src/test/resources/Features/GetUser.feature:84
Sept 24, 2025 10:37:16 AM hooks.CucumberHooks beforeScenario
INFO: Before Scenario: Test is starting!
  Given Send Request Sept 24, 2025 10:37:19 AM utilities.CucumberLogger PrintStatus
INFO: Value is: Response is: {"id":"DSCHMANDT","name":"Daniel Schmandt","businessUnits":[{"bu":"PUBL","roles":[{"name":"R_TAM_PROVIDER"},{"name":"R_TECHNICAL_CS"},{"name":"R_TECHNICAL_RO"},{"name":"£SENTI_BUSINESS_UNIT"},{"name":"£SENTI_BUSINESS_UNIT"},{"name":"R_TECHN_NOT_DEACTIV_USER"},{"name":"R_TECHNICAL_NOT_DELETE_USER"}]},{"bu":null,"roles":[]},{"bu":null,"roles":[]},{"bu":null,"roles":[]}]}
to get Authentication Token for ICOS      # stepDefinations.GetUserSteps.sendRequestToGetAuthenticationTokenForICOS()
  When I generate the JWT Token                                # stepDefinations.GetUserSteps.iGenerateTheJWTToken()
  And I get the Customer ID from Database "UserWith1BUQuery"   # stepDefinations.GetUserSteps.iGetTheCustomerIDFromDatabase(java.lang.String)
  Then Send Request to get User Role Information               # stepDefinations.GetUserSteps.sendRequestToGetUserRoleInformation()
  And I verify the Status Code "200"                           # stepDefinations.GetUserSteps.iVerifyTheStatusCode(java.lang.String)
  And I verify the BU Name "RBS.CUK"                           # stepDefinations.GetUserSteps.iVerifyTheBUName(java.lang.String)
      java.lang.AssertionError: expected [false] but found [true]
	at org.testng.Assert.fail(Assert.java:111)
	at org.testng.Assert.failNotEquals(Assert.java:1578)
	at org.testng.Assert.assertEqualsImpl(Assert.java:150)
	at org.testng.Assert.assertEquals(Assert.java:132)
	at org.testng.Assert.assertEquals(Assert.java:1067)
	at org.testng.Assert.assertEquals(Assert.java:1031)
	at org.testng.Assert.assertEquals(Assert.java:1077)
	at stepDefinations.GetUserSteps.iVerifyTheBUName(GetUserSteps.java:150)
	at âœ½.I verify the BU Name "RBS.CUK"(file:///C:/Users/girdd/IdeaProjects/icosapitests/src/test/resources/Features/GetUser.feature:79)
  And I verify the UserId                                      # stepDefinations.GetUserSteps.iVerifyTheUserId()
Sept 24, 2025 10:37:20 AM tech.grasshopper.pdf.PDFCucumberReport collectReportConfiguration
INFO: PDF report configuration YAML file not found. Using default settings.
[ERROR] Tests run: 2, Failures: 1, Errors: 1, Skipped: 0, Time elapsed: 21.948 s <<< FAILURE! - in testRunner.Runner
[ERROR] Get User API.Verify the Get User API for User with Greater Than 0 Teams  Time elapsed: 10.987 s  <<< ERROR!
java.lang.NullPointerException: Cannot invoke "utilities.JsonHelper.validateFieldExistsInArray(io.restassured.response.Response, String, String)" because "this.jsonHelper" is null
[ERROR] Get User API.Verify the Get User API for User with One BU  Time elapsed: 2.707 s  <<< FAILURE!
java.lang.AssertionError: expected [false] but found [true]
[INFO] 
[INFO] Results:
[INFO] 
[ERROR] Failures: 
[ERROR]   expected [false] but found [true]
[ERROR] Errors: 
[ERROR]   Cannot invoke "utilities.JsonHelper.validateFieldExistsInArray(io.restassured.response.Response, String, String)" because "this.jsonHelper" is null
[INFO] 
[ERROR] Tests run: 2, Failures: 1, Errors: 1, Skipped: 0
[INFO] 
