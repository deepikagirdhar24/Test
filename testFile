public boolean validateBuHasRole(Response response, String buValue, String expectedRole) throws Exception {
    JsonNode rootNode = objectMapper.readTree(response.asString());
    JsonNode businessUnits = rootNode.path("businessUnits");

    if (businessUnits.isArray()) {
        for (JsonNode buNode : businessUnits) {
            // Match BU
            if (buValue.equals(buNode.path("bu").asText())) {
                JsonNode roles = buNode.path("roles");
                if (roles.isArray()) {
                    for (JsonNode role : roles) {
                        if (expectedRole.equals(role.path("name").asText())) {
                            return true; // ✅ found match
                        }
                    }
                }
            }
        }
    }
    return false; // not found
}

@And("I verify BU {string} contains role {string} in response")
public void iVerifyBuContainsRole(String buValue, String roleName) throws Exception {
    boolean matchFound = jsonHelper.validateBuHasRole(response, buValue, roleName);
    ExtentCucumberAdapter.addTestStepLog("Checking BU '" + buValue + "' contains role '" + roleName + "' → " + matchFound);
    Assert.assertTrue(matchFound, "Role '" + roleName + "' not found for BU '" + buValue + "'");
}
