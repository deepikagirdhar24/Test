Feature: Verify Work Requests API

  Scenario Outline: Verify the Post Work Request API with valid data - <Comments>
    Given Send Request to get Authentication Token for ICOS
    When I generate the JWT Token
    Then Send Request to create Work Request with below details
      | bpId          | <bpId>        |
      | type          | <type>        |
      | subject       | <subject>     |
      | description   | <description> |

    Examples:
      | bpId      | type      | subject | description  |
      | 66329769  | pay_domq  | Subject | Description  |



    @Then("Send Request to create Work Request with below details")
    public void sendRequestToCreateWorkRequestWithDetails(DataTable dataTable) throws JsonProcessingException {
        Map<String, String> mapWorkRequestDetails = dataTable.asMap(String.class, String.class);
        String jwtToken = scenarioContext.getContext("JWTToken");
        response = objWorkRequest.createWorkRequest(strEnvType, "Bearer", jwtToken, mapWorkRequestDetails, scenarioContext);
    }

    // Create Work Request
    public Response createWorkRequest(String strEnvType, String strBearerToken, String strJWTToken,
                                      Map<String, String> mapWorkRequestDetails, ScenarioContext scenarioContext) throws JsonProcessingException {

        String strTYKURL = getTYKURL(strEnvType, "TYK.WORKREQUESTS");
        POJOWorkRequest pojoWorkRequest = Payloads.buildWorkRequestPayload(mapWorkRequestDetails);
        String strRequestBody = objObjectMapper.writeValueAsString(pojoWorkRequest);

        ExtentCucumberAdapter.addTestStepLog("Sending request to Create Work Request");

        Response objResponse = sendPostRequest(strTYKURL, strBearerToken, strJWTToken, strRequestBody, null);
        String strResponseBody = devHelperLibrary.getResponseBody(objResponse);
        objCucumberLogger.PrintStatus("Response is: " + strResponseBody);

        String strWorkRequestOrderId = objResponse.jsonPath().getString("orderId");
        scenarioContext.setContext("workRequestOrderId", strWorkRequestOrderId);

        return objResponse;
    }
