package ICOS;

import ICOS.pojo.ContactNoteRequest;
import com.fasterxml.jackson.core.JsonProcessingException;
import com.fasterxml.jackson.databind.ObjectMapper;
import io.restassured.response.Response;
import utilities.CucumberLogger;
import utilities.Payloads;
import utilities.ScenarioContext;
import com.aventstack.extentreports.cucumber.adapter.ExtentCucumberAdapter;

import java.util.List;
import java.util.Map;

public class ContactNotes extends BaseApiClient {

    private ObjectMapper objObjectMapper;
    private CucumberLogger objCucumberLogger;

    public ContactNotes() {
        objObjectMapper = new ObjectMapper();
        objCucumberLogger = new CucumberLogger();
    }

    // Create Contact Note for single PersonId
    public Response createContactNote(String strEnvType, String strBearerToken, String strJWTToken,
                                      Map<String, String> mapNoteDetails, ScenarioContext scenarioContext) throws JsonProcessingException {

        String strTYKURL = getTYKURL(strEnvType, "TYK.CONTACTNOTES");
        ContactNoteRequest objContactNoteRequest = Payloads.buildContactNotePayload(mapNoteDetails, scenarioContext);
        String strRequestBody = objObjectMapper.writeValueAsString(objContactNoteRequest);

        ExtentCucumberAdapter.addTestStepLog("Sending request to Create Contact Note");

        Response objResponse = sendPostRequest(strTYKURL, strBearerToken, strJWTToken, strRequestBody, null);
        String strResponseBody = devHelperLibrary.getResponseBody(objResponse);
        objCucumberLogger.PrintStatus("Response is: " + strResponseBody);

        return objResponse;
    }

    // Create Contact Note for multiple PersonIds
    public Response createContactNote(String strEnvType, String strBearerToken, String strJWTToken,
                                      Map<String, String> mapNoteDetails, List<String> lstPersonIds) throws JsonProcessingException {

        String strTYKURL = getTYKURL(strEnvType, "TYK.CONTACTNOTES");
        ContactNoteRequest objContactNoteRequest = Payloads.buildContactNotePayload(mapNoteDetails, lstPersonIds);
        String strRequestBody = objObjectMapper.writeValueAsString(objContactNoteRequest);

        ExtentCucumberAdapter.addTestStepLog("Sending request to Create Contact Note for multiple PersonIds");

        Response objResponse = sendPostRequest(strTYKURL, strBearerToken, strJWTToken, strRequestBody, null);
        String strResponseBody = devHelperLibrary.getResponseBody(objResponse);
        objCucumberLogger.PrintStatus("Response is: " + strResponseBody);

        return objResponse;
    }

    // Get Contact Notes
    public Response getContactNotes(String strEnvType, String strBearerToken, String strJWTToken) {

        String strTYKURL = getTYKURL(strEnvType, "TYK.CONTACTNOTES");

        ExtentCucumberAdapter.addTestStepLog("Sending GET request to fetch Contact Notes");

        Response objResponse = sendGetRequest(strTYKURL, strBearerToken, strJWTToken, null, null);
        String strResponseBody = devHelperLibrary.getResponseBody(objResponse);
        objCucumberLogger.PrintStatus("Response is: " + strResponseBody);

        return objResponse;
    }
}
