public Response createNewPerson(String strEnvType, String strBearerToken, String strJWTToken, Map<String, String> mapPersonDetails) throws JsonProcessingException {

    strAuthentication = objdevHelperLibrary.buildAuthHeader(strBearerToken, strJWTToken);
    strTYKURL = objdevHelperLibrary.getTYKURL(strEnvType, "TYK.CREATENEWPERSON");

    NewPersonRequest personRequest = new NewPersonRequest();
    personRequest.setStrUuid(UUID.randomUUID().toString().substring(0, 7));
    personRequest.setStrSubType(mapPersonDetails.get("subType"));
    personRequest.setStrDomiCountry(mapPersonDetails.get("domicileCountry"));
    personRequest.setStrFirstName(mapPersonDetails.get("firstName"));
    personRequest.setStrLastName(mapPersonDetails.get("lastName"));
    personRequest.setStrGender(mapPersonDetails.get("gender"));

    // Handle multiple nationalities (comma-separated)
    String nationalitiesRaw = mapPersonDetails.get("nationalities");
    List<String> nationalityList = new ArrayList<>();
    if (nationalitiesRaw != null && !nationalitiesRaw.trim().isEmpty()) {
        nationalityList = Arrays.stream(nationalitiesRaw.split(","))
                .map(String::trim)
                .filter(s -> !s.isEmpty())
                .collect(Collectors.toList());
    }
    personRequest.setLstNationalities(nationalityList);

    strJsonBody = new ObjectMapper().writeValueAsString(personRequest);

    // Logging
    ExtentCucumberAdapter.addTestStepLog("Sending request to Create New Person");
    ExtentCucumberAdapter.addTestStepLog("Request URL: " + strTYKURL);
    ExtentCucumberAdapter.addTestStepLog("Request Headers: Authorization=" + strAuthentication);
    ExtentCucumberAdapter.addTestStepLog("Request Body:\n" + strJsonBody);

    response = with().spec(rspec)
            .header("Authorization", strBearerToken + " " + strJWTToken)
            .header("X-TYK-API-KEY", TYK_KEY)
            .header("Content-Type", "application/json")
            .body(strJsonBody)
            .post(strTYKURL);
    
    strResponseBody = objdevHelperLibrary.getResponseBody(response);

    // Logging response
    ExtentCucumberAdapter.addTestStepLog("Response Code: " + response.getStatusCode());
    ExtentCucumberAdapter.addTestStepLog("Response Body:\n" + strResponseBody);

    strObjectId = response.jsonPath().getString("objectId");
    strOrderId = response.jsonPath().getString("orderId");

    objCucumberLogger.PrintStatus("Response is" + strResponseBody);

    ExtentCucumberAdapter.addTestStepLog("Extracted Object Id is : " + strObjectId);
    ExtentCucumberAdapter.addTestStepLog("Extracted Order Id is : " + strOrderId);

    return response;
}


Scenario Outline: Verify the Post Natural Persons API with <Comments>
  Given Send Request to get Authentication Token for ICOS
  When I generate the JWT Token
  And Send request to generate New Person with below details
    | firstName       | <firstName>     |
    | lastName        | <lastName>      |
    | subType         | <subType>       |
    | domicileCountry | <domiCountry>   |
    | gender          | <gender>        |
    | nationalities   | <nationalities> |
  And I verify the Status Code for Natural Persons "<statusCode>"
  And I verify the ObjectId
  And I verify the OrderId

Examples:
  | firstName | lastName | subType        | domiCountry | gender | nationalities | statusCode | Comments     |
  | John      | Doe      | pers_form_ass  | GB          | male   | GB,CH         | 200        | Valid Inputs |
  | Alice     | Smith    | pers_form_ass  | US          | female | US            | 200        | Valid Inputs |
